<html><head><title>OfferTask.java</title></head>
<!-- HTMLized with the Beditor
     *c* Bryan Chadwick, 2003 -->
<style type='text/css'><!--
   .def{ color: #000000; }
   .grade{
      border: solid #FF0000 1px;
      background-color: #FFFF60;
   }
   .gcom{ font-weight: bold; background-color: #FFC0C0; }
   .com{ font-style: italic; color: #880000; }
   .keyw{ font-weight: bold; color: #000088; }
   .num{ color: #00AA00; }
   .func{ color: #BB7733; }
   .str{ color: #CC00AB; }
   .prim{ color: #0000FF; }
--></style>
<body><pre><span class="def">
</span><span class="keyw">package</span><span class="def"> player.tasks;

</span><span class="keyw">import</span><span class="def"> logging.Logger;
</span><span class="keyw">import</span><span class="def"> scg.Util;
</span><span class="keyw">import</span><span class="def"> scg.gen.OfferTrans;
</span><span class="keyw">import</span><span class="def"> scg.gen.OfferedChallenge;
</span><span class="keyw">import</span><span class="def"> scg.gen.PlayerContext;
</span><span class="keyw">import</span><span class="def"> scg.gen.ProblemType;
</span><span class="keyw">import</span><span class="def"> edu.neu.ccs.demeterf.lib.List;

</span><span class="com">/** Offer new Challenges, at good prices, that are not currently offered. */</span><span class="def">
</span><span class="keyw">public</span><span class="def"> </span><span class="keyw">class</span><span class="def"> OfferTask {

    </span><span class="keyw">private</span><span class="def"> </span><span class="keyw">final</span><span class="def"> Logger log;

    </span><span class="com">/** Create a OfferTask with the given Logger */</span><span class="def">
    </span><span class="keyw">public</span><span class="def"> </span><span class="func">OfferTask</span><span class="def">(Logger l) {
        log = l;
    }

    </span><span class="com">/** Do the actual creation/offering of new Challenges */</span><span class="def">
    </span><span class="keyw">public</span><span class="def"> List&lt;OfferTrans&gt; </span><span class="func">offer</span><span class="def">(PlayerContext context){
        </span><span class="keyw">final</span><span class="def"> </span><span class="keyw">int</span><span class="def"> MAX_OFFERS = </span><span class="num">2</span><span class="def">; </span><span class="com">/* Should be in Config */</span><span class="def">
        </span><span class="keyw">return</span><span class="def"> </span><span class="func">create</span><span class="def">(MAX_OFFERS, context.</span><span class="func">getAllOffered</span><span class="def">().</span><span class="func">map</span><span class="def">(</span><span class="keyw">new</span><span class="def"> List.Map&lt;OfferedChallenge, ProblemType&gt;() {
            </span><span class="keyw">public</span><span class="def"> ProblemType </span><span class="func">map</span><span class="def">(OfferedChallenge off){
                </span><span class="keyw">return</span><span class="def"> off.</span><span class="func">getPred</span><span class="def">();
            }
        })).</span><span class="func">map</span><span class="def">(</span><span class="keyw">new</span><span class="def"> List.Map&lt;ProblemType, OfferTrans&gt;() {
            </span><span class="keyw">public</span><span class="def"> OfferTrans </span><span class="func">map</span><span class="def">(ProblemType t){
                log.</span><span class="func">notify</span><span class="def">(</span><span class="str">"Offering : "</span><span class="def">+t);
                </span><span class="keyw">return</span><span class="def"> </span><span class="keyw">new</span><span class="def"> </span><span class="func">OfferTrans</span><span class="def">(t, Util.</span><span class="func">random</span><span class="def">());
            }
        });
    }

    </span><span class="keyw">public</span><span class="def"> List&lt;ProblemType&gt; </span><span class="func">create</span><span class="def">(</span><span class="keyw">int</span><span class="def"> many, List&lt;ProblemType&gt; ts){
        </span><span class="keyw">if</span><span class="def"> (many == </span><span class="num">0</span><span class="def">) {
            </span><span class="keyw">return</span><span class="def"> List.</span><span class="func">create</span><span class="def">();
        }
        List&lt;ProblemType&gt; newts = </span><span class="func">create</span><span class="def">(many - </span><span class="num">1</span><span class="def">, ts);
        </span><span class="keyw">return</span><span class="def"> newts.</span><span class="func">push</span><span class="def">(</span><span class="func">freshPred</span><span class="def">(newts.</span><span class="func">push</span><span class="def">(ts)));
    }

    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">static</span><span class="def"> ProblemType </span><span class="func">freshPred</span><span class="def">(List&lt;ProblemType&gt; ts){
        ProblemType pt;
        </span><span class="keyw">do</span><span class="def"> {
            pt = ProblemType.</span><span class="func">random</span><span class="def">();
        } </span><span class="keyw">while</span><span class="def"> (ts.</span><span class="func">contains</span><span class="def">(pt));
        </span><span class="keyw">return</span><span class="def"> pt;
    }
}
</span></pre></body></html>