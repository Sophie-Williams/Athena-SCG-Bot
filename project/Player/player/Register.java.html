<html><head><title>Register.java</title></head>
<!-- HTMLized with the Beditor
     *c* Bryan Chadwick, 2003 -->
<style type='text/css'><!--
   .def{ color: #000000; }
   .grade{
      border: solid #FF0000 1px;
      background-color: #FFFF60;
   }
   .gcom{ font-weight: bold; background-color: #FFC0C0; }
   .com{ font-style: italic; color: #880000; }
   .keyw{ font-weight: bold; color: #000088; }
   .num{ color: #00AA00; }
   .func{ color: #BB7733; }
   .str{ color: #CC00AB; }
   .prim{ color: #0000FF; }
--></style>
<body><pre><span class="def">
</span><span class="keyw">package</span><span class="def"> player;

</span><span class="keyw">import</span><span class="def"> edu.neu.ccs.demeterf.http.classes.HTTPReq;
</span><span class="keyw">import</span><span class="def"> edu.neu.ccs.demeterf.http.classes.HTTPResp;

</span><span class="keyw">import</span><span class="def"> logging.Logger;
</span><span class="keyw">import</span><span class="def"> scg.Constants;
</span><span class="keyw">import</span><span class="def"> scg.gen.PlayerSpec;
</span><span class="keyw">import</span><span class="def"> edu.neu.ccs.demeterf.lib.List;
</span><span class="keyw">import</span><span class="def"> edu.neu.ccs.demeterf.util.CLI;

</span><span class="com">/** Register a Player with the Administrator */</span><span class="def">
</span><span class="keyw">public</span><span class="def"> </span><span class="keyw">class</span><span class="def"> Register {

    </span><span class="com">/** The Registration Server Address and Port, e.g., "blaster.ccs.neu.edu:8000" */</span><span class="def">
    </span><span class="prim">String</span><span class="def"> regServer;
    </span><span class="com">/** A logger instance */</span><span class="def">
    Logger log;

    </span><span class="com">/** Construct a PlayerMain*/</span><span class="def">
    </span><span class="func">Register</span><span class="def">(</span><span class="prim">String</span><span class="def"> reg, Logger l) {
        regServer = reg;
        log = l;
    }

    </span><span class="com">/** Print usage information and Quit */</span><span class="def">
    </span><span class="keyw">static</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">usage</span><span class="def">(</span><span class="prim">String</span><span class="def"> err){
        System.err.</span><span class="func">println</span><span class="def">(</span><span class="str">"\n !! "</span><span class="def">+err+</span><span class="str">"\n\n"</span><span class="def">
                + </span><span class="str">" !! Usage: java Register &lt;PlayerPort&gt; &lt;RegServerAddr&gt; "</span><span class="def">
                + </span><span class="str">"&lt;TeamName&gt; &lt;Password&gt;\n\n"</span><span class="def">
                + </span><span class="str">" Typical Usage will be:\n"</span><span class="def">
                + </span><span class="str">"    java player.Register 7000 aurail.ccs.neu.edu:8000 \"MyTeam\" \"MyPass\"\n"</span><span class="def">);
        System.</span><span class="func">exit</span><span class="def">(</span><span class="num">1</span><span class="def">);
    }
    
    </span><span class="com">/** Register a Player... */</span><span class="def">
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">static</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">main</span><span class="def">(</span><span class="prim">String</span><span class="def">[] argArr) </span><span class="keyw">throws</span><span class="def"> Exception{
        List&lt;</span><span class="prim">String</span><span class="def">&gt; args = CLI.</span><span class="func">splitArgs</span><span class="def">(argArr)[CLI.ARGS];
        </span><span class="keyw">if</span><span class="def">(args.</span><span class="func">length</span><span class="def">() != </span><span class="num">4</span><span class="def">){
            </span><span class="func">usage</span><span class="def">(</span><span class="str">"Not enough manditory arguments"</span><span class="def">);
            </span><span class="keyw">return</span><span class="def">;
        }
        </span><span class="com">// Plort the Player will be waiting on</span><span class="def">
        </span><span class="keyw">int</span><span class="def"> port = </span><span class="prim">Integer</span><span class="def">.</span><span class="func">parseInt</span><span class="def">(args.</span><span class="func">lookup</span><span class="def">(</span><span class="num">0</span><span class="def">));
        
        </span><span class="prim">String</span><span class="def"> regserve = args.</span><span class="func">lookup</span><span class="def">(</span><span class="num">1</span><span class="def">),
               teamName = args.</span><span class="func">lookup</span><span class="def">(</span><span class="num">2</span><span class="def">),
               pass = args.</span><span class="func">lookup</span><span class="def">(</span><span class="num">3</span><span class="def">);
        
        </span><span class="com">// Setup a logger to StdOut, and a file</span><span class="def">
        Logger log = Logger.</span><span class="func">text</span><span class="def">(System.out, scg.Util.</span><span class="func">logFileName</span><span class="def">(</span><span class="str">"player"</span><span class="def">));

        </span><span class="com">// New register instance</span><span class="def">
        Register reg = </span><span class="keyw">new</span><span class="def"> </span><span class="func">Register</span><span class="def">(regserve, log);
        </span><span class="com">// If registration fails, just exit</span><span class="def">
        </span><span class="keyw">if</span><span class="def">(!reg.</span><span class="func">doReg</span><span class="def">(teamName, pass, port))
            System.</span><span class="func">exit</span><span class="def">(</span><span class="num">1</span><span class="def">);
        </span><span class="com">// Otherwise, Success!</span><span class="def">
        log.</span><span class="func">event</span><span class="def">(</span><span class="str">"Player '</span><span class="def"></span><span class="str">" + teamName + "</span><span class="def"></span><span class="str">' Registered Successfully"</span><span class="def">);
    }

    </span><span class="com">/** Register this Player with the Administrator's registration server */</span><span class="def">
    </span><span class="keyw">public</span><span class="def"> HTTPResp </span><span class="func">register</span><span class="def">(</span><span class="prim">String</span><span class="def"> name, </span><span class="prim">String</span><span class="def"> pass, </span><span class="keyw">int</span><span class="def"> port) </span><span class="keyw">throws</span><span class="def"> Exception{
        </span><span class="prim">String</span><span class="def"> URL = Constants.REG_PATH_ENTRY + </span><span class="str">"?"</span><span class="def"> + Constants.PASS_URL_ARG + </span><span class="str">"="</span><span class="def"> + pass;
        HTTPResp res = HTTPReq.</span><span class="func">Post</span><span class="def">(URL, </span><span class="str">""</span><span class="def"> + </span><span class="keyw">new</span><span class="def"> </span><span class="func">PlayerSpec</span><span class="def">(name, Constants.REG_AUTO, port))
        .</span><span class="func">send</span><span class="def">(regServer, Constants.REG_PORT);
        </span><span class="keyw">return</span><span class="def"> res;
    }

    </span><span class="com">/** Try to register the player, and check the response */</span><span class="def">
    </span><span class="keyw">boolean</span><span class="def"> </span><span class="func">doReg</span><span class="def">(</span><span class="prim">String</span><span class="def"> team, </span><span class="prim">String</span><span class="def"> pass, </span><span class="keyw">int</span><span class="def"> port){
        </span><span class="keyw">try</span><span class="def"> {
            </span><span class="com">// Check the registration </span><span class="def">
            HTTPResp res = </span><span class="func">register</span><span class="def">(team, pass, port);
            </span><span class="com">// Error response</span><span class="def">
            </span><span class="keyw">if</span><span class="def"> (res.</span><span class="func">isError</span><span class="def">()) {
                log.</span><span class="func">error</span><span class="def">(</span><span class="str">"Couldn'</span><span class="def">t Register Team </span><span class="str">'"</span><span class="def"> + team + </span><span class="str">"'</span><span class="def"> with Password </span><span class="str">'"</span><span class="def"> + pass + </span><span class="str">"'</span><span class="def"></span><span class="str">");
                log.error("</span><span class="def">Reason: </span><span class="str">" + res.getBody());
                log.shutdown();
                return false;
            }
        } catch (Exception e) {
            // Exception means the socket was bad
            log.error("</span><span class="def">Error Registering Player </span><span class="str">'"</span><span class="def"> + team + </span><span class="str">"'</span><span class="def"></span><span class="str">");
            log.error("</span><span class="def">Reason: </span><span class="str">" + e);
            log.shutdown();
            return false;
        }
        // Otherwise all good
        return true;
    }
}
</span><span class="def"></span></pre></body></html>