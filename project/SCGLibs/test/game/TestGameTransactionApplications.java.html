<html><head><title>TestGameTransactionApplications.java</title></head>
<!-- HTMLized with the Beditor
     *c* Bryan Chadwick, 2003 -->
<style type='text/css'><!--
   .def{ color: #000000; }
   .grade{
      border: solid #FF0000 1px;
      background-color: #FFFF60;
   }
   .gcom{ font-weight: bold; background-color: #FFC0C0; }
   .com{ font-style: italic; color: #880000; }
   .keyw{ font-weight: bold; color: #000088; }
   .num{ color: #00AA00; }
   .func{ color: #BB7733; }
   .str{ color: #CC00AB; }
   .prim{ color: #0000FF; }
--></style>
<body><pre><span class="def">
</span><span class="keyw">package</span><span class="def"> test.game;

</span><span class="keyw">import</span><span class="def"> </span><span class="keyw">static</span><span class="def"> org.junit.Assert.assertEquals;
</span><span class="keyw">import</span><span class="def"> </span><span class="keyw">static</span><span class="def"> org.junit.Assert.fail;

</span><span class="keyw">import</span><span class="def"> java.util.ArrayList;
</span><span class="keyw">import</span><span class="def"> java.util.List;

</span><span class="keyw">import</span><span class="def"> org.junit.Before;
</span><span class="keyw">import</span><span class="def"> org.junit.Test;

</span><span class="keyw">import</span><span class="def"> scg.game.Game;
</span><span class="keyw">import</span><span class="def"> scg.game.LocalPlayerProxy;
</span><span class="keyw">import</span><span class="def"> scg.game.Game.Player;
</span><span class="keyw">import</span><span class="def"> scg.gen.AcceptedChallenge;
</span><span class="keyw">import</span><span class="def"> scg.gen.Config;
</span><span class="keyw">import</span><span class="def"> scg.gen.Objective;
</span><span class="keyw">import</span><span class="def"> scg.gen.OfferedChallenge;
</span><span class="keyw">import</span><span class="def"> scg.gen.PlayerContext;
</span><span class="keyw">import</span><span class="def"> scg.gen.PlayerSpec;
</span><span class="keyw">import</span><span class="def"> scg.gen.PlayerTrans;
</span><span class="keyw">import</span><span class="def"> scg.gen.Predicate;
</span><span class="keyw">import</span><span class="def"> scg.gen.Problem;
</span><span class="keyw">import</span><span class="def"> scg.gen.ProblemType;
</span><span class="keyw">import</span><span class="def"> scg.gen.ProvidedChallenge;

</span><span class="keyw">public</span><span class="def"> </span><span class="keyw">class</span><span class="def"> TestGameTransactionApplications {

    Config config;
    LocalPlayerProxy player1;
    LocalPlayerProxy player2;
    ArrayList&lt;</span><span class="prim">Integer</span><span class="def">&gt; playerIds;
    Game game;

    @Before
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">init</span><span class="def">() </span><span class="keyw">throws</span><span class="def"> Exception{
        config = </span><span class="keyw">new</span><span class="def"> </span><span class="func">Config</span><span class="def">(</span><span class="str">"CSP"</span><span class="def">, </span><span class="num">60</span><span class="def">, </span><span class="num">0</span><span class="def">.</span><span class="num">01</span><span class="def">, </span><span class="num">15</span><span class="def">, </span><span class="keyw">new</span><span class="def"> </span><span class="func">Objective</span><span class="def">(), </span><span class="keyw">new</span><span class="def"> </span><span class="func">Predicate</span><span class="def">(), </span><span class="num">5</span><span class="def">, </span><span class="num">1</span><span class="def">.</span><span class="num">0</span><span class="def">, </span><span class="num">2</span><span class="def">);
        player1 = </span><span class="keyw">new</span><span class="def"> </span><span class="func">LocalPlayerProxy</span><span class="def">(</span><span class="keyw">new</span><span class="def"> </span><span class="func">PlayerSpec</span><span class="def">(</span><span class="str">"Player1"</span><span class="def">, </span><span class="str">"127.0.0.1"</span><span class="def">, </span><span class="num">8001</span><span class="def">), </span><span class="keyw">null</span><span class="def">);
        player2 = </span><span class="keyw">new</span><span class="def"> </span><span class="func">LocalPlayerProxy</span><span class="def">(</span><span class="keyw">new</span><span class="def"> </span><span class="func">PlayerSpec</span><span class="def">(</span><span class="str">"Player2"</span><span class="def">, </span><span class="str">"127.0.0.1"</span><span class="def">, </span><span class="num">8002</span><span class="def">), </span><span class="keyw">null</span><span class="def">);
        game = </span><span class="keyw">new</span><span class="def"> </span><span class="func">Game</span><span class="def">(config, player1, player2);
        edu.neu.ccs.demeterf.lib.List&lt;Player&gt; players = game.</span><span class="func">getPlayersTable</span><span class="def">();
        playerIds = </span><span class="keyw">new</span><span class="def"> ArrayList&lt;</span><span class="prim">Integer</span><span class="def">&gt;();
        </span><span class="keyw">for</span><span class="def"> (Player player : players) {
            playerIds.</span><span class="func">add</span><span class="def">(player.</span><span class="func">getId</span><span class="def">());
        }
    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">offeredTransactionShowsUpInOurOffered</span><span class="def">() </span><span class="keyw">throws</span><span class="def"> Exception{
        </span><span class="keyw">int</span><span class="def"> pid = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">);
        PlayerTrans trans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + pid + </span><span class="str">" offer[(12 13 25) 2.0]  ]"</span><span class="def">);
        trans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);
        PlayerContext context = game.</span><span class="func">getPlayerContext</span><span class="def">(pid, </span><span class="num">1</span><span class="def">);
        List&lt;OfferedChallenge&gt; offered = context.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">toJavaList</span><span class="def">();
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">1</span><span class="def">, offered.</span><span class="func">size</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(pid, offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getChallenger</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(ProblemType.</span><span class="func">parse</span><span class="def">(</span><span class="str">"(12 13 25)"</span><span class="def">), offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPred</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">2</span><span class="def">.</span><span class="num">0</span><span class="def">, offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPrice</span><span class="def">(), </span><span class="num">0</span><span class="def">.</span><span class="num">01</span><span class="def">);

        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getTheirOffered</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getAccepted</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getBalance</span><span class="def">(), config.</span><span class="func">getInitacc</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getProvided</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">offeredTransactionShowsUpInTheirOffered</span><span class="def">() </span><span class="keyw">throws</span><span class="def"> Exception{
        </span><span class="keyw">int</span><span class="def"> pid = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">1</span><span class="def">);
        PlayerTrans trans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + pid + </span><span class="str">" offer[(12 13 25) 2.0]  ]"</span><span class="def">);
        trans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);
        PlayerContext context = game.</span><span class="func">getPlayerContext</span><span class="def">(playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">), </span><span class="num">1</span><span class="def">);
        List&lt;OfferedChallenge&gt; offered = context.</span><span class="func">getTheirOffered</span><span class="def">().</span><span class="func">toJavaList</span><span class="def">();
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">1</span><span class="def">, offered.</span><span class="func">size</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(pid, offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getChallenger</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(ProblemType.</span><span class="func">parse</span><span class="def">(</span><span class="str">"(12 13 25)"</span><span class="def">), offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPred</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">2</span><span class="def">.</span><span class="num">0</span><span class="def">, offered.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPrice</span><span class="def">(), </span><span class="num">0</span><span class="def">.</span><span class="num">01</span><span class="def">);

        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getAccepted</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getBalance</span><span class="def">(), config.</span><span class="func">getInitacc</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(context.</span><span class="func">getProvided</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">testApplyAcceptedTransaction</span><span class="def">() </span><span class="keyw">throws</span><span class="def"> Exception{
        </span><span class="keyw">int</span><span class="def"> challenger = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">);
        PlayerTrans offerTrans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + challenger + </span><span class="str">" offer[(12 13 25) 2.0]  ]"</span><span class="def">);
        offerTrans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);
        </span><span class="keyw">int</span><span class="def"> challengee = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">1</span><span class="def">);
        PlayerContext challengerContext = game.</span><span class="func">getPlayerContext</span><span class="def">(challenger, </span><span class="num">1</span><span class="def">);
        </span><span class="keyw">int</span><span class="def"> offerchallengeKey = challengerContext.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">top</span><span class="def">().</span><span class="func">getKey</span><span class="def">();
        PlayerTrans acceptTrans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + challengee + </span><span class="str">" accept["</span><span class="def"> + offerchallengeKey
                + </span><span class="str">"]  ]"</span><span class="def">);
        acceptTrans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);

        PlayerContext challengerContext2 = game.</span><span class="func">getPlayerContext</span><span class="def">(challenger, </span><span class="num">1</span><span class="def">);
        List&lt;AcceptedChallenge&gt; accepted = challengerContext2.</span><span class="func">getAccepted</span><span class="def">().</span><span class="func">toJavaList</span><span class="def">();
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">1</span><span class="def">, accepted.</span><span class="func">size</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(challenger, accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getChallenger</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(challengee, accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getChallengee</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(ProblemType.</span><span class="func">parse</span><span class="def">(</span><span class="str">"(12 13 25)"</span><span class="def">), accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPred</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">2</span><span class="def">.</span><span class="num">0</span><span class="def">, accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPrice</span><span class="def">(), </span><span class="num">0</span><span class="def">.</span><span class="num">01</span><span class="def">);

        </span><span class="func">assertEquals</span><span class="def">(challengerContext2.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(challengerContext2.</span><span class="func">getTheirOffered</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(challengerContext2.</span><span class="func">getBalance</span><span class="def">(), config.</span><span class="func">getInitacc</span><span class="def">() + accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPrice</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(challengerContext2.</span><span class="func">getProvided</span><span class="def">().</span><span class="func">length</span><span class="def">(), </span><span class="num">0</span><span class="def">);

        PlayerContext challengeeContext = game.</span><span class="func">getPlayerContext</span><span class="def">(challengee, </span><span class="num">1</span><span class="def">);
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">0</span><span class="def">, challengeeContext.</span><span class="func">getTheirOffered</span><span class="def">().</span><span class="func">length</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">0</span><span class="def">, challengeeContext.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">length</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(</span><span class="num">0</span><span class="def">, challengeeContext.</span><span class="func">getAccepted</span><span class="def">().</span><span class="func">length</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(config.</span><span class="func">getInitacc</span><span class="def">() - accepted.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">).</span><span class="func">getPrice</span><span class="def">(), challengeeContext.</span><span class="func">getBalance</span><span class="def">());

    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">testApplyProvideTransaction</span><span class="def">() </span><span class="keyw">throws</span><span class="def"> Exception{
        </span><span class="keyw">int</span><span class="def"> challenger = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">0</span><span class="def">);
        PlayerTrans offerTrans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + challenger + </span><span class="str">" offer[(12 13 25) 2.0]  ]"</span><span class="def">);
        offerTrans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);

        </span><span class="keyw">int</span><span class="def"> challengee = playerIds.</span><span class="func">get</span><span class="def">(</span><span class="num">1</span><span class="def">);
        PlayerContext challengerContext = game.</span><span class="func">getPlayerContext</span><span class="def">(challenger, </span><span class="num">1</span><span class="def">);
        </span><span class="keyw">int</span><span class="def"> offerchallengeKey = challengerContext.</span><span class="func">getOurOffered</span><span class="def">().</span><span class="func">top</span><span class="def">().</span><span class="func">getKey</span><span class="def">();
        PlayerTrans acceptTrans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + challengee + </span><span class="str">" accept["</span><span class="def"> + offerchallengeKey
                + </span><span class="str">"]  ]"</span><span class="def">);
        acceptTrans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);

        </span><span class="prim">String</span><span class="def"> problem = </span><span class="str">"v1 v2 v3 v4 v5 (12 v1 v2 v3) (13 v2 v3 v4) (25 v1 v2 v5) (12 v1 v5 v3)"</span><span class="def">;
        PlayerTrans provideTrans = PlayerTrans.</span><span class="func">parse</span><span class="def">(</span><span class="str">"playertrans[ "</span><span class="def"> + challenger + </span><span class="str">" provide["</span><span class="def"> + problem + </span><span class="str">" "</span><span class="def">
                + offerchallengeKey + </span><span class="str">"]  ]"</span><span class="def">);
        provideTrans.</span><span class="func">applyTransactions</span><span class="def">(game, </span><span class="keyw">false</span><span class="def">);

        PlayerContext challengerContext2 = game.</span><span class="func">getPlayerContext</span><span class="def">(challenger, </span><span class="num">1</span><span class="def">);
        PlayerContext challengeeContext = game.</span><span class="func">getPlayerContext</span><span class="def">(challengee, </span><span class="num">1</span><span class="def">);

        ProvidedChallenge providedChallenge = challengeeContext.</span><span class="func">getProvided</span><span class="def">().</span><span class="func">top</span><span class="def">();
        </span><span class="func">assertEquals</span><span class="def">(challenger, providedChallenge.</span><span class="func">getChallenger</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(challengee, providedChallenge.</span><span class="func">getChallengee</span><span class="def">().</span><span class="func">getId</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(offerchallengeKey, providedChallenge.</span><span class="func">getKey</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(Problem.</span><span class="func">parse</span><span class="def">(problem), providedChallenge.</span><span class="func">getInstance</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(config.</span><span class="func">getInitacc</span><span class="def">() - providedChallenge.</span><span class="func">getPrice</span><span class="def">(), challengeeContext.</span><span class="func">getBalance</span><span class="def">());
        </span><span class="func">assertEquals</span><span class="def">(challengerContext2.</span><span class="func">getBalance</span><span class="def">(), config.</span><span class="func">getInitacc</span><span class="def">() + providedChallenge.</span><span class="func">getPrice</span><span class="def">());
    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">testApplySolveTransaction</span><span class="def">(){
        </span><span class="func">fail</span><span class="def">(</span><span class="str">"Not yet implemented"</span><span class="def">);
    }

    @Test
    </span><span class="keyw">public</span><span class="def"> </span><span class="keyw">void</span><span class="def"> </span><span class="func">testApplyReofferTransaction</span><span class="def">(){
        </span><span class="func">fail</span><span class="def">(</span><span class="str">"Not yet implemented"</span><span class="def">);
    }

}
</span></pre></body></html>